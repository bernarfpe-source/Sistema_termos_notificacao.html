
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Termos de Notifica√ß√£o ‚Äî AGER / ANTT</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f14;
    --surface: #151820;
    --surface2: #1c2030;
    --border: #252a3a;
    --accent: #4f8ef7;
    --accent2: #7c5cfc;
    --green: #22c981;
    --yellow: #f5c842;
    --red: #f75c5c;
    --orange: #f7924f;
    --text: #e8eaf0;
    --muted: #6b7280;
    --muted2: #9ca3af;
    --font-head: 'Syne', sans-serif;
    --font-body: 'DM Sans', sans-serif;
    --shadow: 0 4px 24px rgba(0,0,0,0.3);
  }

  :root.light {
    --bg: #f0f2f7;
    --surface: #ffffff;
    --surface2: #f5f6fa;
    --border: #e2e5ef;
    --accent: #2563eb;
    --accent2: #7c3aed;
    --green: #16a34a;
    --yellow: #d97706;
    --red: #dc2626;
    --orange: #ea580c;
    --text: #111827;
    --muted: #9ca3af;
    --muted2: #6b7280;
    --shadow: 0 4px 24px rgba(0,0,0,0.08);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  body {
    font-family: var(--font-body);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    font-size: 14px;
  }

  /* SIDEBAR */
  .sidebar {
    position: fixed; left: 0; top: 0; bottom: 0;
    width: 220px;
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex; flex-direction: column;
    z-index: 100;
  }

  .logo {
    padding: 24px 20px 20px;
    border-bottom: 1px solid var(--border);
  }

  .logo-badge {
    display: inline-flex; align-items: center; gap: 6px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    padding: 4px 10px;
    border-radius: 20px;
    font-family: var(--font-head);
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: #fff;
    margin-bottom: 8px;
  }

  .logo h1 {
    font-family: var(--font-head);
    font-size: 15px;
    font-weight: 700;
    color: var(--text);
    line-height: 1.3;
  }

  .logo p {
    font-size: 11px;
    color: var(--muted);
    margin-top: 2px;
  }

  .nav {
    padding: 16px 12px;
    flex: 1;
  }

  .nav-section {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.12em;
    color: var(--muted);
    text-transform: uppercase;
    padding: 4px 8px;
    margin-bottom: 6px;
    margin-top: 16px;
  }

  .nav-item {
    display: flex; align-items: center; gap: 10px;
    padding: 9px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    color: var(--muted2);
    transition: all 0.15s;
    user-select: none;
  }

  .nav-item:hover { background: var(--surface2); color: var(--text); }
  .nav-item.active { background: rgba(79,142,247,0.12); color: var(--accent); font-weight: 500; }

  .nav-item svg { width: 16px; height: 16px; flex-shrink: 0; }

  .nav-badge {
    margin-left: auto;
    background: var(--red);
    color: #fff;
    font-size: 10px;
    font-weight: 700;
    padding: 1px 6px;
    border-radius: 10px;
  }

  .sidebar-footer {
    padding: 16px;
    border-top: 1px solid var(--border);
    font-size: 11px;
    color: var(--muted);
    text-align: center;
  }

  /* MAIN */
  .main {
    margin-left: 220px;
    min-height: 100vh;
    display: flex; flex-direction: column;
  }

  .topbar {
    height: 58px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; gap: 16px;
    padding: 0 28px;
    position: sticky; top: 0; z-index: 50;
  }

  .topbar h2 {
    font-family: var(--font-head);
    font-size: 16px;
    font-weight: 700;
    flex: 1;
  }

  .search-wrap {
    position: relative;
  }

  .search-wrap svg {
    position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
    width: 14px; height: 14px; color: var(--muted);
  }

  .search-input {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 7px 12px 7px 32px;
    color: var(--text);
    font-family: var(--font-body);
    font-size: 13px;
    width: 240px;
    outline: none;
    transition: border-color 0.2s;
  }

  .search-input:focus { border-color: var(--accent); }
  .search-input::placeholder { color: var(--muted); }

  .btn {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 7px 14px;
    border-radius: 8px;
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.15s;
  }

  .btn-primary {
    background: var(--accent);
    color: #fff;
  }

  .btn-primary:hover { background: #3b7de8; }

  .btn-ghost {
    background: var(--surface2);
    color: var(--muted2);
    border: 1px solid var(--border);
  }

  .btn-ghost:hover { color: var(--text); border-color: var(--muted); }

  /* CONTENT */
  .content { padding: 28px; flex: 1; }

  /* PAGES */
  .page { display: none; }
  .page.active { display: block; }

  /* STATS GRID */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
  }

  .stat-card.blue::before { background: linear-gradient(90deg, var(--accent), var(--accent2)); }
  .stat-card.green::before { background: var(--green); }
  .stat-card.yellow::before { background: var(--yellow); }
  .stat-card.red::before { background: var(--red); }

  .stat-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
    font-weight: 600;
    margin-bottom: 8px;
  }

  .stat-value {
    font-family: var(--font-head);
    font-size: 32px;
    font-weight: 800;
    line-height: 1;
    margin-bottom: 6px;
  }

  .stat-sub { font-size: 12px; color: var(--muted2); }

  /* FILTERS */
  .filters-bar {
    display: flex; gap: 10px; align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .filter-select {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 7px 12px;
    color: var(--text);
    font-family: var(--font-body);
    font-size: 13px;
    outline: none;
    cursor: pointer;
    transition: border-color 0.2s;
  }

  .filter-select:focus { border-color: var(--accent); }

  .filter-label {
    font-size: 12px;
    color: var(--muted);
    font-weight: 500;
  }

  /* TABLE */
  .table-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .table-head-row {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--surface2);
  }

  .table-count {
    font-size: 12px;
    color: var(--muted);
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  thead th {
    text-align: left;
    padding: 10px 16px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--muted);
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
  }

  tbody tr {
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    transition: background 0.1s;
  }

  tbody tr:last-child { border-bottom: none; }
  tbody tr:hover { background: var(--surface2); }

  tbody td {
    padding: 12px 16px;
    font-size: 13px;
    vertical-align: middle;
  }

  .td-num {
    font-family: var(--font-head);
    font-weight: 700;
    font-size: 12px;
    color: var(--muted2);
    white-space: nowrap;
  }

  .td-termo {
    max-width: 220px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-size: 13px;
    color: var(--text);
  }

  .td-assunto {
    max-width: 180px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: var(--muted2);
    font-size: 12px;
  }

  .tag {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    white-space: nowrap;
  }

  .tag-empresa-rn { background: rgba(79,142,247,0.15); color: var(--accent); }
  .tag-empresa-xv { background: rgba(124,92,252,0.15); color: var(--accent2); }
  .tag-ager { background: rgba(34,201,129,0.15); color: var(--green); }
  .tag-antt { background: rgba(245,200,66,0.15); color: var(--yellow); }

  .status-dot {
    display: inline-flex; align-items: center; gap: 5px;
    font-size: 12px;
    white-space: nowrap;
  }

  .status-dot::before {
    content: '';
    width: 7px; height: 7px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .status-vencido { color: var(--red); }
  .status-vencido::before { background: var(--red); box-shadow: 0 0 6px var(--red); }
  
  .status-urgente { color: var(--orange); }
  .status-urgente::before { background: var(--orange); animation: pulse 1.5s infinite; }
  
  .status-ok { color: var(--green); }
  .status-ok::before { background: var(--green); }
  
  .status-encerrado { color: var(--muted); }
  .status-encerrado::before { background: var(--muted); }
  
  .status-pendente { color: var(--muted2); }
  .status-pendente::before { background: var(--muted2); }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  .prazo-date { font-size: 12px; color: var(--muted2); }
  .prazo-vencido { color: var(--red); font-weight: 600; }
  .prazo-urgente { color: var(--orange); font-weight: 600; }

  /* PAGINATION */
  .pagination {
    display: flex; align-items: center; gap: 8px; justify-content: center;
    padding: 16px;
    border-top: 1px solid var(--border);
  }

  .page-btn {
    width: 32px; height: 32px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.15s;
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--muted2);
  }

  .page-btn:hover { color: var(--text); border-color: var(--muted); }
  .page-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }
  .page-btn.disabled { opacity: 0.3; pointer-events: none; }

  .page-info { font-size: 12px; color: var(--muted); margin: 0 8px; }

  /* MODAL */
  .modal-overlay {
    display: none;
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 200;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    width: 680px;
    max-height: 85vh;
    overflow-y: auto;
    padding: 0;
    animation: modalIn 0.2s ease;
  }

  @keyframes modalIn {
    from { opacity: 0; transform: scale(0.96) translateY(10px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }

  .modal-header {
    padding: 24px 28px 20px;
    border-bottom: 1px solid var(--border);
    display: flex; align-items: flex-start; gap: 16px;
  }

  .modal-icon {
    width: 44px; height: 44px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }

  .modal-icon svg { width: 22px; height: 22px; color: #fff; }

  .modal-header h3 {
    font-family: var(--font-head);
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .modal-header p { font-size: 12px; color: var(--muted2); }

  .modal-close {
    margin-left: auto;
    cursor: pointer;
    color: var(--muted);
    padding: 4px;
    transition: color 0.2s;
  }

  .modal-close:hover { color: var(--text); }
  .modal-close svg { width: 20px; height: 20px; }

  .modal-body {
    padding: 24px 28px;
  }

  .detail-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 20px;
  }

  .detail-field label {
    display: block;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--muted);
    font-weight: 600;
    margin-bottom: 4px;
  }

  .detail-field .val {
    font-size: 13px;
    color: var(--text);
    font-weight: 400;
  }

  .detail-field .val.mono {
    font-family: var(--font-head);
    font-weight: 700;
  }

  .desc-box {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px 16px;
    font-size: 13px;
    color: var(--muted2);
    line-height: 1.6;
    margin-top: 4px;
  }

  .status-select-wrap {
    display: flex; gap: 8px; align-items: center; margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
  }

  .status-select-wrap label {
    font-size: 12px; color: var(--muted); font-weight: 500; min-width: 80px;
  }

  /* DASHBOARD */
  .chart-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 20px;
  }

  .chart-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
  }

  .chart-title {
    font-family: var(--font-head);
    font-size: 13px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 16px;
  }

  .bar-chart {}

  .bar-row {
    display: flex; align-items: center; gap: 10px;
    margin-bottom: 10px;
  }

  .bar-label {
    font-size: 11px;
    color: var(--muted2);
    width: 200px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-shrink: 0;
  }

  .bar-track {
    flex: 1;
    height: 8px;
    background: var(--surface2);
    border-radius: 4px;
    overflow: hidden;
  }

  .bar-fill {
    height: 100%;
    border-radius: 4px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .bar-val {
    font-size: 11px;
    font-weight: 700;
    color: var(--muted2);
    min-width: 24px;
    text-align: right;
  }

  /* DONUT */
  .donut-wrap {
    display: flex; align-items: center; gap: 20px;
  }

  .donut-legend {}

  .donut-item {
    display: flex; align-items: center; gap: 8px;
    margin-bottom: 8px;
    font-size: 12px; color: var(--muted2);
  }

  .donut-dot {
    width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
  }

  .donut-item strong { color: var(--text); }

  /* NOVO FORM */
  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  .form-field {
    display: flex; flex-direction: column; gap: 6px;
  }

  .form-field.full { grid-column: 1 / -1; }

  .form-field label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
    font-weight: 600;
  }

  .form-field input, .form-field select, .form-field textarea {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 9px 12px;
    color: var(--text);
    font-family: var(--font-body);
    font-size: 13px;
    outline: none;
    transition: border-color 0.2s;
    width: 100%;
  }

  .form-field input:focus, .form-field select:focus, .form-field textarea:focus {
    border-color: var(--accent);
  }

  .form-field textarea { resize: vertical; min-height: 90px; }

  .form-actions {
    display: flex; gap: 10px; justify-content: flex-end;
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
  }

  /* ALERTS */
  .alerts-list {
    display: flex; flex-direction: column; gap: 10px;
    margin-bottom: 24px;
  }

  .alert-item {
    display: flex; align-items: center; gap: 14px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 18px;
    cursor: pointer;
    transition: border-color 0.15s;
  }

  .alert-item:hover { border-color: var(--muted); }
  .alert-item.red { border-left: 3px solid var(--red); }
  .alert-item.orange { border-left: 3px solid var(--orange); }

  .alert-icon {
    width: 36px; height: 36px;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }

  .alert-icon.red { background: rgba(247,92,92,0.15); color: var(--red); }
  .alert-icon.orange { background: rgba(247,146,79,0.15); color: var(--orange); }
  .alert-icon svg { width: 18px; height: 18px; }

  .alert-content { flex: 1; }
  .alert-title { font-size: 13px; font-weight: 500; margin-bottom: 2px; }
  .alert-sub { font-size: 12px; color: var(--muted2); }
  .alert-date { font-size: 11px; color: var(--muted); white-space: nowrap; }

  /* THEME TOGGLE */
  .theme-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 5px 12px 5px 6px;
    cursor: pointer;
    transition: all 0.2s;
    user-select: none;
    flex-shrink: 0;
  }

  .theme-toggle:hover { border-color: var(--accent); }

  .toggle-track {
    width: 34px; height: 18px;
    background: var(--border);
    border-radius: 9px;
    position: relative;
    transition: background 0.3s;
    flex-shrink: 0;
  }

  .light .toggle-track { background: var(--accent); }

  .toggle-thumb {
    position: absolute;
    top: 2px; left: 2px;
    width: 14px; height: 14px;
    background: #fff;
    border-radius: 50%;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
  }

  .light .toggle-thumb { transform: translateX(16px); }

  .toggle-icon { font-size: 14px; line-height: 1; }
  .toggle-label { font-size: 12px; color: var(--muted2); font-weight: 500; }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--surface); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--muted); }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }

  .empty-state svg { width: 48px; height: 48px; margin: 0 auto 12px; display: block; opacity: 0.3; }
  .empty-state p { font-size: 14px; }

  /* MODAL ACTIONS */
  .modal-actions {
    display: flex; gap: 8px;
    padding: 16px 28px;
    border-top: 1px solid var(--border);
    background: var(--surface2);
    border-radius: 0 0 16px 16px;
  }
  .btn-danger { background: rgba(247,92,92,0.12); color: var(--red); border: 1px solid rgba(247,92,92,0.3); }
  .btn-danger:hover { background: rgba(247,92,92,0.22); }
  .btn-edit { background: rgba(79,142,247,0.12); color: var(--accent); border: 1px solid rgba(79,142,247,0.3); }
  .btn-edit:hover { background: rgba(79,142,247,0.22); }

  /* ROW ACTIONS */
  .row-actions { display: flex; gap: 4px; opacity: 0; transition: opacity 0.15s; }
  tbody tr:hover .row-actions { opacity: 1; }
  .row-btn { width: 26px; height: 26px; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid var(--border); background: var(--surface); transition: all 0.15s; color: var(--muted2); }
  .row-btn:hover { border-color: var(--accent); color: var(--accent); }
  .row-btn.del:hover { border-color: var(--red); color: var(--red); }
  .row-btn svg { width: 13px; height: 13px; }

  /* CONFIRM */
  .confirm-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 300; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
  .confirm-overlay.open { display: flex; }
  .confirm-box { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 28px; width: 380px; text-align: center; animation: modalIn 0.2s ease; }
  .confirm-box .icon { font-size: 36px; margin-bottom: 12px; }
  .confirm-box h4 { font-family: var(--font-head); font-size: 16px; margin-bottom: 8px; }
  .confirm-box p { font-size: 13px; color: var(--muted2); margin-bottom: 20px; }
  .confirm-btns { display: flex; gap: 10px; justify-content: center; }
</style>
</head>
<body>

<!-- SIDEBAR -->
<nav class="sidebar">
  <div class="logo">
    <div class="logo-badge">
      <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
      JUR√çDICO
    </div>
    <h1>Termos de<br>Notifica√ß√£o</h1>
    <p>AGER &amp; ANTT</p>
  </div>

  <nav class="nav">
    <div class="nav-section">Menu</div>
    <div class="nav-item active" onclick="showPage('dashboard')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
      Dashboard
    </div>
    <div class="nav-item" onclick="showPage('lista')" id="nav-lista">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
      Processos
      <span class="nav-badge" id="badge-vencidos">0</span>
    </div>
    <div class="nav-item" onclick="showPage('alertas')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"/></svg>
      Alertas
      <span class="nav-badge" id="badge-alertas">0</span>
    </div>
    <div class="nav-item" onclick="showPage('novo')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
      Novo Termo
    </div>
  </nav>

  <div class="sidebar-footer">v2025 ¬∑ Setor Jur√≠dico</div>
</nav>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <h2 id="page-title">Dashboard</h2>
    <div class="search-wrap">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      <input class="search-input" type="text" placeholder="Buscar processo, placa..." id="search-input" oninput="onSearch(this.value)">
    </div>
    <div class="theme-toggle" onclick="toggleTheme()" title="Alternar tema claro/escuro">
      <div class="toggle-track"><div class="toggle-thumb"></div></div>
      <span class="toggle-icon" id="theme-icon">üåô</span>
      <span class="toggle-label" id="theme-label">Noturno</span>
    </div>
    <button class="btn btn-primary" onclick="showPage('novo')">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      Novo
    </button>
  </div>

  <div class="content">

    <!-- DASHBOARD PAGE -->
    <div class="page active" id="page-dashboard">
      <div class="stats-grid" id="stats-grid"></div>

      <div class="chart-grid">
        <div class="chart-card">
          <div class="chart-title">Top Infra√ß√µes por Assunto</div>
          <div class="bar-chart" id="chart-assuntos"></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Por Empresa &amp; √ìrg√£o</div>
          <div class="donut-wrap">
            <canvas id="canvas-orgao" width="120" height="120"></canvas>
            <div class="donut-legend" id="legend-orgao"></div>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Evolu√ß√£o Anual de Termos</div>
          <div id="chart-anos"></div>
        </div>
        <div class="chart-card">
          <div class="chart-title">Prazos ‚Äî Situa√ß√£o Atual</div>
          <div id="chart-status"></div>
        </div>
      </div>
    </div>

    <!-- LISTA PAGE -->
    <div class="page" id="page-lista">
      <div class="filters-bar">
        <span class="filter-label">Empresa:</span>
        <select class="filter-select" id="f-empresa" onchange="applyFilters()">
          <option value="">Todas</option>
          <option>Rio Novo</option>
          <option>Xavante</option>
        </select>
        <span class="filter-label">√ìrg√£o:</span>
        <select class="filter-select" id="f-orgao" onchange="applyFilters()">
          <option value="">Todos</option>
          <option>AGER</option>
          <option>ANTT</option>
        </select>
        <span class="filter-label">Ano:</span>
        <select class="filter-select" id="f-ano" onchange="applyFilters()">
          <option value="">Todos</option>
          <option>2025</option>
          <option>2024</option>
          <option>2023</option>
          <option>2022</option>
        </select>
        <span class="filter-label">Tipo:</span>
        <select class="filter-select" id="f-tipo" onchange="applyFilters()">
          <option value="">Todos</option>
          <option>NOTIFICA√á√ÉO</option>
          <option>RECURSO</option>
          <option>IMPUGNA√á√ÉO</option>
          <option>NOTIFICA√á√ÉO REGULAT√ìRIA</option>
          <option>AUTUA√á√ÉO</option>
        </select>
        <button class="btn btn-ghost" onclick="clearFilters()">Limpar</button>
      </div>

      <div class="table-wrap">
        <div class="table-head-row">
          <span class="table-count" id="table-count"></span>
        </div>
        <table>
          <thead>
            <tr>
              <th>N¬∫</th>
              <th>Empresa</th>
              <th>√ìrg√£o</th>
              <th>Tipo</th>
              <th>Assunto</th>
              <th>Local</th>
              <th>Placa</th>
              <th>Prazo</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
        <div class="pagination" id="pagination"></div>
      </div>
    </div>

    <!-- ALERTAS PAGE -->
    <div class="page" id="page-alertas">
      <div class="stats-grid" style="grid-template-columns: repeat(3,1fr); margin-bottom: 24px;">
        <div class="stat-card red">
          <div class="stat-label">‚ö† Prazos Vencidos</div>
          <div class="stat-value" id="alerta-vencidos" style="color:var(--red)">0</div>
          <div class="stat-sub">Requerem aten√ß√£o imediata</div>
        </div>
        <div class="stat-card yellow">
          <div class="stat-label">üîî Vencendo em 7 dias</div>
          <div class="stat-value" id="alerta-urgentes" style="color:var(--yellow)">0</div>
          <div class="stat-sub">A√ß√£o necess√°ria em breve</div>
        </div>
        <div class="stat-card green">
          <div class="stat-label">‚úÖ Prazo OK</div>
          <div class="stat-value" id="alerta-ok" style="color:var(--green)">0</div>
          <div class="stat-sub">Dentro do prazo</div>
        </div>
      </div>
      <div class="alerts-list" id="alerts-list"></div>
    </div>

    <!-- NOVO PAGE -->
    <div class="page" id="page-novo">
      <div style="max-width: 700px;">
        <div style="margin-bottom: 24px;">
          <h3 style="font-family: var(--font-head); font-size: 18px; font-weight: 700; margin-bottom: 6px;">Cadastrar Novo Termo</h3>
          <p style="color: var(--muted2); font-size: 13px;">Preencha os dados do processo e salve no sistema.</p>
        </div>
        <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 28px;">
          <div class="form-grid">
            <div class="form-field">
              <label>Empresa *</label>
              <select id="n-empresa">
                <option value="">Selecione</option>
                <option>Rio Novo</option>
                <option>Xavante</option>
              </select>
            </div>
            <div class="form-field">
              <label>√ìrg√£o *</label>
              <select id="n-orgao">
                <option value="">Selecione</option>
                <option>AGER</option>
                <option>ANTT</option>
              </select>
            </div>
            <div class="form-field">
              <label>Tipo *</label>
              <select id="n-tipo">
                <option value="">Selecione</option>
                <option>NOTIFICA√á√ÉO</option>
                <option>RECURSO</option>
                <option>IMPUGNA√á√ÉO</option>
                <option>NOTIFICA√á√ÉO REGULAT√ìRIA</option>
                <option>AUTUA√á√ÉO</option>
              </select>
            </div>
            <div class="form-field">
              <label>N¬∫ do Termo</label>
              <input type="text" id="n-numero" placeholder="Ex: TN-0001/2025">
            </div>
            <div class="form-field">
              <label>Data de Entrada *</label>
              <input type="date" id="n-data">
            </div>
            <div class="form-field">
              <label>Prazo Final</label>
              <input type="date" id="n-prazo">
            </div>
            <div class="form-field full">
              <label>Assunto *</label>
              <input type="text" id="n-assunto" placeholder="Ex: Atraso no hor√°rio de partida">
            </div>
            <div class="form-field">
              <label>Setor</label>
              <select id="n-setor">
                <option value="">Selecione</option>
                <option>OPERACIONAL</option>
                <option>COMERCIAL</option>
                <option>COMERCIAL/OPERACIONAL</option>
                <option>TECNOLOGIA DE INFORMA√á√ÉO</option>
                <option>ADMINISTRATIVO</option>
              </select>
            </div>
            <div class="form-field">
              <label>Local da Autua√ß√£o</label>
              <input type="text" id="n-local" placeholder="Ex: Cuiab√°/MT">
            </div>
            <div class="form-field">
              <label>Prefixo</label>
              <input type="text" id="n-prefixo" placeholder="Ex: 14010">
            </div>
            <div class="form-field">
              <label>Placa</label>
              <input type="text" id="n-placa" placeholder="Ex: PVP7189">
            </div>
            <div class="form-field full">
              <label>Descri√ß√£o / Hist√≥rico</label>
              <textarea id="n-descricao" placeholder="Descreva os fatos e detalhes do processo..."></textarea>
            </div>
            <div class="form-field full">
              <label>Status</label>
              <select id="n-status">
                <option>PENDENTE</option>
                <option>EM AN√ÅLISE</option>
                <option>RESPONDIDA</option>
                <option>PROTOCOLADO</option>
                <option>ENCERRADO</option>
              </select>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-ghost" onclick="showPage('lista')">Cancelar</button>
            <button class="btn btn-primary" onclick="salvarNovo()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
              Salvar Processo
            </button>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</main>

<!-- MODAL -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
  <div class="modal" id="modal">
    <div class="modal-header">
      <div class="modal-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
      </div>
      <div>
        <h3 id="modal-title">Detalhe do Processo</h3>
        <p id="modal-sub"></p>
      </div>
      <div class="modal-close" onclick="document.getElementById('modal-overlay').classList.remove('open')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </div>
    </div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<!-- CONFIRM DELETE -->
<div class="confirm-overlay" id="confirm-overlay">
  <div class="confirm-box">
    <div class="icon">üóëÔ∏è</div>
    <h4>Excluir processo?</h4>
    <p id="confirm-text">Esta a√ß√£o n√£o pode ser desfeita.</p>
    <div class="confirm-btns">
      <button class="btn btn-ghost" onclick="document.getElementById('confirm-overlay').classList.remove('open')">Cancelar</button>
      <button class="btn btn-danger" id="confirm-ok-btn">Excluir</button>
    </div>
  </div>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="edit-overlay" onclick="closeEditModal(event)">
  <div class="modal" style="width:720px">
    <div class="modal-header">
      <div class="modal-icon" style="background:linear-gradient(135deg,var(--accent2),var(--accent))">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      </div>
      <div><h3>Editar Processo</h3><p id="edit-sub">Altere os dados e salve</p></div>
      <div class="modal-close" onclick="document.getElementById('edit-overlay').classList.remove('open')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </div>
    </div>
    <div class="modal-body">
      <input type="hidden" id="e-id">
      <div class="form-grid">
        <div class="form-field"><label>Empresa *</label><select id="e-empresa"><option value="">Selecione</option><option>Rio Novo</option><option>Xavante</option></select></div>
        <div class="form-field"><label>√ìrg√£o *</label><select id="e-orgao"><option value="">Selecione</option><option>AGER</option><option>ANTT</option></select></div>
        <div class="form-field"><label>Tipo *</label><select id="e-tipo"><option value="">Selecione</option><option>NOTIFICA√á√ÉO</option><option>RECURSO</option><option>IMPUGNA√á√ÉO</option><option>NOTIFICA√á√ÉO REGULAT√ìRIA</option><option>AUTUA√á√ÉO</option></select></div>
        <div class="form-field"><label>N¬∫ do Termo</label><input type="text" id="e-numero"></div>
        <div class="form-field"><label>Data de Entrada *</label><input type="date" id="e-data"></div>
        <div class="form-field"><label>Prazo Final</label><input type="date" id="e-prazo"></div>
        <div class="form-field full"><label>Assunto *</label><input type="text" id="e-assunto"></div>
        <div class="form-field"><label>Setor</label><select id="e-setor"><option value="">Selecione</option><option>OPERACIONAL</option><option>COMERCIAL</option><option>COMERCIAL/OPERACIONAL</option><option>OPERACIONAL/COMERCIAL</option><option>TECNOLOGIA DE INFORMA√á√ÉO</option><option>ADMINISTRATIVO</option></select></div>
        <div class="form-field"><label>Local da Autua√ß√£o</label><input type="text" id="e-local"></div>
        <div class="form-field"><label>Prefixo</label><input type="text" id="e-prefixo"></div>
        <div class="form-field"><label>Placa</label><input type="text" id="e-placa"></div>
        <div class="form-field full"><label>Descri√ß√£o / Hist√≥rico</label><textarea id="e-descricao"></textarea></div>
        <div class="form-field"><label>Status</label><select id="e-status"><option>PENDENTE</option><option>EM AN√ÅLISE</option><option>RESPONDIDA</option><option>PROTOCOLADO</option><option>ENCERRADO</option></select></div>
        <div class="form-field"><label>Observa√ß√µes</label><input type="text" id="e-obs"></div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="document.getElementById('edit-overlay').classList.remove('open')">Cancelar</button>
      <button class="btn btn-primary" onclick="salvarEdicao()" style="margin-left:auto">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        Salvar Altera√ß√µes
      </button>
    </div>
  </div>
</div>

<script>
// ===== DATA ‚Äî persistido em localStorage =====
function loadRecords() {
  try {
    const saved = localStorage.getItem('tn_records');
    return saved ? JSON.parse(saved) : [];
  } catch(e) { return []; }
}

function saveRecords() {
  try { localStorage.setItem('tn_records', JSON.stringify(allRecords)); } catch(e) {}
}

let allRecords = loadRecords();
const today = new Date('2026-02-18');

function getPrazoStatus(r) {
  const p = r.prazo;
  if (!p || p === '' || p === '-') return 'pendente';
  if (['ENCERRADO','FINALIZADO','RESPONDIDA','PROTOCOLO'].some(s => p.toUpperCase().includes(s))) return 'encerrado';
  if (['URG√äNTE','URGENTE'].includes(p.toUpperCase())) return 'urgente';
  if (p === '48 HORAS') return 'urgente';
  const d = new Date(p);
  if (isNaN(d)) return 'pendente';
  const diff = (d - today) / (1000*60*60*24);
  if (diff < 0) return 'vencido';
  if (diff <= 7) return 'urgente';
  return 'ok';
}

function prazoLabel(r) {
  const p = r.prazo;
  if (!p || p === '') return '‚Äî';
  if (p.match(/^\d{4}-\d{2}-\d{2}$/)) {
    const d = new Date(p);
    return d.toLocaleDateString('pt-BR', {day:'2-digit',month:'2-digit',year:'numeric'});
  }
  return p;
}

// ===== PAGES =====
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  const navMap = {dashboard:'Dashboard', lista:'Processos', alertas:'Alertas', novo:'Novo Termo'};
  document.getElementById('page-title').textContent = navMap[name] || name;
  const ni = document.querySelector(`.nav-item[onclick*="${name}"]`);
  if (ni) ni.classList.add('active');

  if (name === 'dashboard') renderDashboard();
  if (name === 'lista') renderLista();
  if (name === 'alertas') renderAlertas();
}

// ===== DASHBOARD =====
function renderDashboard() {
  const total = allRecords.length;
  const vencidos = allRecords.filter(r => getPrazoStatus(r) === 'vencido').length;
  const urgentes = allRecords.filter(r => getPrazoStatus(r) === 'urgente').length;
  const encerrados = allRecords.filter(r => getPrazoStatus(r) === 'encerrado').length;

  document.getElementById('stats-grid').innerHTML = `
    <div class="stat-card blue">
      <div class="stat-label">Total de Processos</div>
      <div class="stat-value">${total}</div>
      <div class="stat-sub">2022 ‚Äì 2025</div>
    </div>
    <div class="stat-card red">
      <div class="stat-label">Prazos Vencidos</div>
      <div class="stat-value" style="color:var(--red)">${vencidos}</div>
      <div class="stat-sub">Requerem aten√ß√£o</div>
    </div>
    <div class="stat-card yellow">
      <div class="stat-label">Urgentes (7 dias)</div>
      <div class="stat-value" style="color:var(--yellow)">${urgentes}</div>
      <div class="stat-sub">Em alerta</div>
    </div>
    <div class="stat-card green">
      <div class="stat-label">Encerrados</div>
      <div class="stat-value" style="color:var(--green)">${encerrados}</div>
      <div class="stat-sub">Finalizados</div>
    </div>`;

  // Update badges
  document.getElementById('badge-vencidos').textContent = vencidos;
  document.getElementById('badge-alertas').textContent = vencidos + urgentes;

  // Chart assuntos
  const assuntoCnt = {};
  allRecords.forEach(r => {
    const a = r.assunto || 'Outros';
    assuntoCnt[a] = (assuntoCnt[a] || 0) + 1;
  });
  const top = Object.entries(assuntoCnt).sort((a,b) => b[1]-a[1]).slice(0, 8);
  const maxV = top[0]?.[1] || 1;
  document.getElementById('chart-assuntos').innerHTML = top.map(([a, c]) => `
    <div class="bar-row">
      <div class="bar-label" title="${a}">${a}</div>
      <div class="bar-track"><div class="bar-fill" style="width:${(c/maxV*100).toFixed(0)}%"></div></div>
      <div class="bar-val">${c}</div>
    </div>`).join('');

  // Donut empresas
  const groups = {};
  allRecords.forEach(r => {
    const k = `${r.empresa} / ${r.orgao}`;
    groups[k] = (groups[k] || 0) + 1;
  });
  const colors = ['#4f8ef7','#7c5cfc','#22c981','#f5c842','#f75c5c','#f7924f'];
  const legend = document.getElementById('legend-orgao');
  const entries = Object.entries(groups).sort((a,b) => b[1]-a[1]);
  legend.innerHTML = entries.map(([k, c], i) => `
    <div class="donut-item">
      <div class="donut-dot" style="background:${colors[i%colors.length]}"></div>
      <span>${k}</span>
      <strong style="margin-left:4px">${c}</strong>
    </div>`).join('');
  drawDonut('canvas-orgao', entries.map(([,c]) => c), colors);

  // Anos chart
  const anoCnt = {};
  allRecords.forEach(r => { anoCnt[r.ano] = (anoCnt[r.ano]||0)+1; });
  const anos = Object.entries(anoCnt).sort((a,b)=>a[0].localeCompare(b[0]));
  const maxA = Math.max(...anos.map(a=>a[1]));
  document.getElementById('chart-anos').innerHTML = `<div class="bar-chart">${anos.map(([a,c]) => `
    <div class="bar-row">
      <div class="bar-label">${a}</div>
      <div class="bar-track"><div class="bar-fill" style="width:${(c/maxA*100).toFixed(0)}%;background:linear-gradient(90deg,var(--green),var(--accent))"></div></div>
      <div class="bar-val">${c}</div>
    </div>`).join('')}</div>`;

  // Status chart
  const stCnt = {vencido:0, urgente:0, ok:0, encerrado:0, pendente:0};
  allRecords.forEach(r => { stCnt[getPrazoStatus(r)]++; });
  const stColors = {vencido:'var(--red)',urgente:'var(--orange)',ok:'var(--green)',encerrado:'var(--muted)',pendente:'var(--muted2)'};
  const stLabels = {vencido:'Vencido',urgente:'Urgente',ok:'No Prazo',encerrado:'Encerrado',pendente:'Sem Prazo'};
  const stTotal = Object.values(stCnt).reduce((a,b)=>a+b,0);
  document.getElementById('chart-status').innerHTML = `<div class="bar-chart">${Object.entries(stCnt).map(([k,c]) => `
    <div class="bar-row">
      <div class="bar-label" style="color:${stColors[k]}">${stLabels[k]}</div>
      <div class="bar-track"><div class="bar-fill" style="width:${(c/stTotal*100).toFixed(0)}%;background:${stColors[k]}"></div></div>
      <div class="bar-val">${c}</div>
    </div>`).join('')}</div>`;
}

function drawDonut(id, values, colors) {
  const canvas = document.getElementById(id);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const total = values.reduce((a,b)=>a+b,0);
  let angle = -Math.PI/2;
  const cx = 60, cy = 60, r = 45, ir = 28;
  ctx.clearRect(0,0,120,120);
  values.forEach((v, i) => {
    const slice = (v/total) * Math.PI * 2;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, angle, angle + slice);
    ctx.closePath();
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    angle += slice;
  });
  ctx.beginPath();
  ctx.arc(cx, cy, ir, 0, Math.PI*2);
  ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--surface').trim() || '#151820';
  ctx.fill();
  ctx.fillStyle = 'var(--muted2)';
  ctx.font = 'bold 14px Syne, sans-serif';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(total, cx, cy);
}

// ===== LISTA =====
let currentPage = 1;
const PER_PAGE = 20;
let filtered = [];
let searchQ = '';

function applyFilters() {
  const emp = document.getElementById('f-empresa').value;
  const org = document.getElementById('f-orgao').value;
  const ano = document.getElementById('f-ano').value;
  const tipo = document.getElementById('f-tipo').value;
  const q = searchQ.toLowerCase();

  filtered = allRecords.filter(r => {
    if (emp && r.empresa !== emp) return false;
    if (org && r.orgao !== org) return false;
    if (ano && r.ano !== ano) return false;
    if (tipo && r.tipo !== tipo) return false;
    if (q) {
      const hay = `${r.numero} ${r.assunto} ${r.placa} ${r.local} ${r.empresa} ${r.descricao}`.toLowerCase();
      if (!hay.includes(q)) return false;
    }
    return true;
  });

  currentPage = 1;
  renderTable();
}

function clearFilters() {
  ['f-empresa','f-orgao','f-ano','f-tipo'].forEach(id => document.getElementById(id).value = '');
  searchQ = '';
  document.getElementById('search-input').value = '';
  applyFilters();
}

function onSearch(v) {
  searchQ = v;
  applyFilters();
}

function renderLista() {
  filtered = [...allRecords];
  renderTable();
}

function renderTable() {
  const total = filtered.length;
  document.getElementById('table-count').textContent = `${total} processo${total !== 1 ? 's' : ''} encontrado${total !== 1 ? 's' : ''}`;

  const start = (currentPage - 1) * PER_PAGE;
  const page = filtered.slice(start, start + PER_PAGE);

  const tbody = document.getElementById('table-body');
  if (!page.length) {
    tbody.innerHTML = `<tr><td colspan="9"><div class="empty-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      <p>Nenhum processo encontrado</p></div></td></tr>`;
    document.getElementById('pagination').innerHTML = '';
    return;
  }

  tbody.innerHTML = page.map(r => {
    const st = getPrazoStatus(r);
    const stMap = {vencido:'status-vencido', urgente:'status-urgente', ok:'status-ok', encerrado:'status-encerrado', pendente:'status-pendente'};
    const stLbl = {vencido:'Vencido', urgente:'Urgente', ok:'No prazo', encerrado:'Encerrado', pendente:'Pendente'};
    const empTag = r.empresa === 'Rio Novo' ? 'tag-empresa-rn' : 'tag-empresa-xv';
    const orgTag = r.orgao === 'AGER' ? 'tag-ager' : 'tag-antt';
    const prazo = prazoLabel(r);
    const prazoClass = st === 'vencido' ? 'prazo-vencido' : st === 'urgente' ? 'prazo-urgente' : 'prazo-date';
    return `<tr onclick="openModal(${r.id})">
      <td class="td-num">${r.numero || '‚Äî'}</td>
      <td><span class="tag ${empTag}">${r.empresa}</span></td>
      <td><span class="tag ${orgTag}">${r.orgao}</span></td>
      <td style="font-size:11px;color:var(--muted2)">${r.tipo}</td>
      <td class="td-assunto" title="${r.assunto}">${r.assunto || '‚Äî'}</td>
      <td style="font-size:12px;color:var(--muted2)">${r.local || '‚Äî'}</td>
      <td style="font-size:12px;font-family:var(--font-head);font-weight:700">${r.placa || '‚Äî'}</td>
      <td class="${prazoClass}">${prazo}</td>
      <td><span class="status-dot ${stMap[st]}">${stLbl[st]}</span></td>
      <td onclick="event.stopPropagation()">
        <div class="row-actions">
          <div class="row-btn" title="Editar" onclick="abrirEdicao(${r.id})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          </div>
          <div class="row-btn del" title="Excluir" onclick="confirmarExclusao(${r.id})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/><path d="M10 11v6M14 11v6"/></svg>
          </div>
        </div>
      </td>
    </tr>`;
  }).join('');

  renderPagination(total);
}

function renderPagination(total) {
  const totalPages = Math.ceil(total / PER_PAGE);
  const pag = document.getElementById('pagination');
  if (totalPages <= 1) { pag.innerHTML = ''; return; }

  let html = `<div class="page-btn ${currentPage === 1 ? 'disabled' : ''}" onclick="goPage(${currentPage-1})">‚Äπ</div>`;
  for (let i = 1; i <= totalPages; i++) {
    if (i === 1 || i === totalPages || Math.abs(i - currentPage) <= 2) {
      html += `<div class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goPage(${i})">${i}</div>`;
    } else if (Math.abs(i - currentPage) === 3) {
      html += `<div class="page-btn disabled">‚Ä¶</div>`;
    }
  }
  html += `<div class="page-btn ${currentPage === totalPages ? 'disabled' : ''}" onclick="goPage(${currentPage+1})">‚Ä∫</div>`;
  html += `<span class="page-info">P√°gina ${currentPage} de ${totalPages}</span>`;
  pag.innerHTML = html;
}

function goPage(p) {
  currentPage = p;
  renderTable();
  document.querySelector('.table-wrap').scrollIntoView({behavior:'smooth', block:'start'});
}

// ===== ALERTAS =====
function renderAlertas() {
  const vencidos = allRecords.filter(r => getPrazoStatus(r) === 'vencido');
  const urgentes = allRecords.filter(r => getPrazoStatus(r) === 'urgente');
  const oks = allRecords.filter(r => getPrazoStatus(r) === 'ok');

  document.getElementById('alerta-vencidos').textContent = vencidos.length;
  document.getElementById('alerta-urgentes').textContent = urgentes.length;
  document.getElementById('alerta-ok').textContent = oks.length;

  const list = document.getElementById('alerts-list');
  const items = [...vencidos.map(r => ({r, cls:'red', icon:'‚ö†', label:'VENCIDO'})), ...urgentes.map(r => ({r, cls:'orange', icon:'üîî', label:'URGENTE'}))];
  
  if (!items.length) {
    list.innerHTML = `<div style="text-align:center;padding:60px;color:var(--muted)">
      <div style="font-size:48px;margin-bottom:12px">‚úÖ</div>
      <p>Nenhum prazo urgente ou vencido no momento.</p></div>`;
    return;
  }

  list.innerHTML = items.map(({r, cls, label}) => `
    <div class="alert-item ${cls}" onclick="openModal(${r.id})">
      <div class="alert-icon ${cls}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      </div>
      <div class="alert-content">
        <div class="alert-title">${r.numero || '‚Äî'} ‚Äî ${r.assunto || '‚Äî'}</div>
        <div class="alert-sub">${r.empresa} ¬∑ ${r.orgao} ¬∑ ${r.ano} ${r.placa ? '¬∑ ' + r.placa : ''}</div>
      </div>
      <div>
        <span class="tag" style="background:${cls==='red'?'rgba(247,92,92,0.15)':'rgba(247,146,79,0.15)'};color:${cls==='red'?'var(--red)':'var(--orange)'}">${label}</span>
        <div class="alert-date" style="margin-top:4px">${prazoLabel(r)}</div>
      </div>
    </div>`).join('');
}

// ===== MODAL =====
function openModal(id) {
  const r = allRecords.find(x => x.id === id);
  if (!r) return;
  const st = getPrazoStatus(r);
  const stMap = {vencido:'status-vencido', urgente:'status-urgente', ok:'status-ok', encerrado:'status-encerrado', pendente:'status-pendente'};
  const stLbl = {vencido:'Vencido', urgente:'Urgente', ok:'No prazo', encerrado:'Encerrado', pendente:'Pendente'};

  document.getElementById('modal-title').textContent = r.numero || 'Sem n√∫mero';
  document.getElementById('modal-sub').textContent = `${r.empresa} ¬∑ ${r.orgao} ¬∑ ${r.ano}`;

  document.getElementById('modal-body').innerHTML = `
    <div class="detail-grid">
      <div class="detail-field">
        <label>Empresa</label>
        <div class="val">${r.empresa}</div>
      </div>
      <div class="detail-field">
        <label>√ìrg√£o</label>
        <div class="val">${r.orgao}</div>
      </div>
      <div class="detail-field">
        <label>Tipo</label>
        <div class="val">${r.tipo}</div>
      </div>
      <div class="detail-field">
        <label>Setor</label>
        <div class="val">${r.setor || '‚Äî'}</div>
      </div>
      <div class="detail-field">
        <label>Data de Entrada</label>
        <div class="val">${r.data_entrada ? new Date(r.data_entrada).toLocaleDateString('pt-BR') : '‚Äî'}</div>
      </div>
      <div class="detail-field">
        <label>Prazo Final</label>
        <div class="val ${st === 'vencido' ? 'prazo-vencido' : st === 'urgente' ? 'prazo-urgente' : ''}">${prazoLabel(r)}</div>
      </div>
      <div class="detail-field">
        <label>Local da Autua√ß√£o</label>
        <div class="val">${r.local || '‚Äî'}</div>
      </div>
      <div class="detail-field">
        <label>Ve√≠culo</label>
        <div class="val mono">${[r.prefixo, r.placa].filter(x => x && x !== '-').join(' / ') || '‚Äî'}</div>
      </div>
    </div>
    <div class="detail-field" style="margin-bottom:16px">
      <label>Assunto</label>
      <div class="val" style="font-size:14px;font-weight:500;color:var(--text)">${r.assunto || '‚Äî'}</div>
    </div>
    ${r.descricao ? `<div class="detail-field"><label>Descri√ß√£o / Hist√≥rico</label><div class="desc-box">${r.descricao}</div></div>` : ''}
    ${r.obs ? `<div class="detail-field" style="margin-top:12px"><label>Observa√ß√µes</label><div class="desc-box">${r.obs}</div></div>` : ''}
    <div class="status-select-wrap">
      <label>Status:</label>
      <span class="status-dot ${stMap[st]}" style="margin-right:12px">${stLbl[st]}</span>
      <select class="filter-select" onchange="updateStatus(${r.id}, this.value)" style="flex:1">
        <option value="">‚Äî Atualizar status ‚Äî</option>
        <option>PENDENTE</option>
        <option>EM AN√ÅLISE</option>
        <option>RESPONDIDA</option>
        <option>PROTOCOLADO</option>
        <option>ENCERRADO</option>
      </select>
    </div>`;

  // Add action buttons to modal footer
  const modal = document.getElementById('modal');
  let existingActions = modal.querySelector('.modal-actions');
  if (existingActions) existingActions.remove();
  const actionsDiv = document.createElement('div');
  actionsDiv.className = 'modal-actions';
  actionsDiv.innerHTML = `
    <button class="btn btn-danger" onclick="confirmarExclusao(${r.id})">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2"/></svg>
      Excluir
    </button>
    <button class="btn btn-edit" style="margin-left:auto" onclick="abrirEdicao(${r.id})">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Editar
    </button>`;
  modal.appendChild(actionsDiv);

  document.getElementById('modal-overlay').classList.add('open');
}

function updateStatus(id, val) {
  if (!val) return;
  const r = allRecords.find(x => x.id === id);
  if (r) { r.status = val; r.prazo = val === 'ENCERRADO' ? 'ENCERRADO' : r.prazo; }
  saveRecords();
}

function closeModal(e) {
  if (e.target === document.getElementById('modal-overlay')) {
    document.getElementById('modal-overlay').classList.remove('open');
  }
}

function closeEditModal(e) {
  if (e.target === document.getElementById('edit-overlay')) {
    document.getElementById('edit-overlay').classList.remove('open');
  }
}

function confirmarExclusao(id) {
  const r = allRecords.find(x => x.id === id);
  if (!r) return;
  document.getElementById('confirm-text').textContent = `Excluir "${r.numero || 'processo'}" (${r.empresa} ¬∑ ${r.orgao})?`;
  const btn = document.getElementById('confirm-ok-btn');
  btn.onclick = () => {
    excluirProcesso(id);
    document.getElementById('confirm-overlay').classList.remove('open');
    document.getElementById('modal-overlay').classList.remove('open');
  };
  document.getElementById('confirm-overlay').classList.add('open');
}

function excluirProcesso(id) {
  allRecords = allRecords.filter(r => r.id !== id);
  saveRecords();
  applyFilters();
  renderDashboard();
  updateBadges();
}

function abrirEdicao(id) {
  const r = allRecords.find(x => x.id === id);
  if (!r) return;
  document.getElementById('edit-sub').textContent = `${r.empresa} ¬∑ ${r.orgao} ¬∑ ${r.ano}`;
  document.getElementById('e-id').value = r.id;
  document.getElementById('e-empresa').value = r.empresa || '';
  document.getElementById('e-orgao').value = r.orgao || '';
  document.getElementById('e-tipo').value = r.tipo || '';
  document.getElementById('e-numero').value = r.numero || '';
  document.getElementById('e-data').value = r.data_entrada || '';
  document.getElementById('e-prazo').value = (r.prazo && r.prazo.match(/^\d{4}-\d{2}-\d{2}$/)) ? r.prazo : '';
  document.getElementById('e-assunto').value = r.assunto || '';
  document.getElementById('e-setor').value = r.setor || '';
  document.getElementById('e-local').value = r.local || '';
  document.getElementById('e-prefixo').value = r.prefixo || '';
  document.getElementById('e-placa').value = r.placa || '';
  document.getElementById('e-descricao').value = r.descricao || '';
  document.getElementById('e-status').value = r.status || 'PENDENTE';
  document.getElementById('e-obs').value = r.obs || '';
  document.getElementById('modal-overlay').classList.remove('open');
  document.getElementById('edit-overlay').classList.add('open');
}

function salvarEdicao() {
  const id = parseInt(document.getElementById('e-id').value);
  const empresa = document.getElementById('e-empresa').value;
  const orgao = document.getElementById('e-orgao').value;
  const tipo = document.getElementById('e-tipo').value;
  const assunto = document.getElementById('e-assunto').value;
  const data = document.getElementById('e-data').value;
  if (!empresa || !orgao || !tipo || !assunto || !data) {
    alert('Preencha os campos obrigat√≥rios (*)');
    return;
  }
  const idx = allRecords.findIndex(x => x.id === id);
  if (idx === -1) return;
  allRecords[idx] = {
    ...allRecords[idx],
    empresa, orgao, tipo,
    numero: document.getElementById('e-numero').value || allRecords[idx].numero,
    data_entrada: data,
    prazo: document.getElementById('e-prazo').value || allRecords[idx].prazo,
    assunto: assunto.toUpperCase(),
    setor: document.getElementById('e-setor').value,
    local: document.getElementById('e-local').value,
    prefixo: document.getElementById('e-prefixo').value,
    placa: document.getElementById('e-placa').value,
    descricao: document.getElementById('e-descricao').value,
    status: document.getElementById('e-status').value,
    obs: document.getElementById('e-obs').value,
    ano: new Date(data).getFullYear().toString(),
  };
  saveRecords();
  applyFilters();
  renderDashboard();
  updateBadges();
  document.getElementById('edit-overlay').classList.remove('open');
}

// ===== NOVO =====
function salvarNovo() {
  const empresa = document.getElementById('n-empresa').value;
  const orgao = document.getElementById('n-orgao').value;
  const tipo = document.getElementById('n-tipo').value;
  const assunto = document.getElementById('n-assunto').value;
  const data = document.getElementById('n-data').value;

  if (!empresa || !orgao || !tipo || !assunto || !data) {
    alert('Preencha os campos obrigat√≥rios (*)');
    return;
  }

  const rec = {
    id: allRecords.length,
    empresa, orgao, tipo,
    numero: document.getElementById('n-numero').value || `TN-${String(allRecords.length+1).padStart(4,'0')}`,
    data_entrada: data,
    prazo: document.getElementById('n-prazo').value || '',
    assunto: assunto.toUpperCase(),
    setor: document.getElementById('n-setor').value,
    local: document.getElementById('n-local').value,
    prefixo: document.getElementById('n-prefixo').value,
    placa: document.getElementById('n-placa').value,
    descricao: document.getElementById('n-descricao').value,
    status: document.getElementById('n-status').value,
    obs: '',
    ano: new Date(data).getFullYear().toString(),
  };

  allRecords.unshift(rec);
  saveRecords();

  // Reset form
  ['n-empresa','n-orgao','n-tipo','n-setor','n-status'].forEach(id => document.getElementById(id).value = '');
  ['n-numero','n-data','n-prazo','n-assunto','n-local','n-prefixo','n-placa','n-descricao'].forEach(id => document.getElementById(id).value = '');

  showPage('lista');
  alert(`‚úÖ Processo "${rec.numero}" cadastrado com sucesso!`);
}

// ===== THEME =====
function toggleTheme() {
  const html = document.documentElement;
  const isLight = html.classList.toggle('light');
  document.getElementById('theme-icon').textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
  document.getElementById('theme-label').textContent = isLight ? 'Diurno' : 'Noturno';
  localStorage.setItem('theme', isLight ? 'light' : 'dark');
  // Redraw donut with updated bg color
  if (document.getElementById('page-dashboard').classList.contains('active')) {
    setTimeout(renderDashboard, 50);
  }
}

// Restore saved theme
(function() {
  const saved = localStorage.getItem('theme');
  if (saved === 'light') {
    document.documentElement.classList.add('light');
    document.addEventListener('DOMContentLoaded', () => {
      const icon = document.getElementById('theme-icon');
      const label = document.getElementById('theme-label');
      if (icon) icon.textContent = '‚òÄÔ∏è';
      if (label) label.textContent = 'Diurno';
    });
  }
})();

function updateBadges() {
  document.getElementById('badge-vencidos').textContent = allRecords.filter(r => getPrazoStatus(r) === 'vencido').length;
  document.getElementById('badge-alertas').textContent = allRecords.filter(r => ['vencido','urgente'].includes(getPrazoStatus(r))).length;
}

// ===== INIT =====
renderDashboard();
updateBadges();
</script>
</body>
</html>
